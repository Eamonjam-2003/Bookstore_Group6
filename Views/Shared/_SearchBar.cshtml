<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<form id="searchForm" class="mb-3">
    <input type="text" id="searchInput" name="searchTerm" class="form-control" placeholder="Search books..." autocomplete="off" required />
    <button type="submit" class="btn btn-primary mt-2">Search</button>
</form>

<ul id="autocompleteResults" class="list-group mt-2"></ul>

<div id="searchResults" class="mt-3"></div>

<div id="searchError" class="mt-3 text-danger" style="display:none;"></div>

<script>
    $(document).ready(function () {
        // AutoComplete Feature
        $("#searchInput").on("keyup", function () {
            let query = $(this).val();
            if (query.length >= 2) { // Only start searching after 2 characters
                $.ajax({
                    url: '@Url.Action("SearchBooks", "Books")',
                    type: "GET",
                    data: { query: query },
                    success: function (data) {
                        let resultsHtml = "";
                        if (data.length > 0) {
                            data.forEach(book => {
                                resultsHtml += `<li class="list-group-item autocomplete-item">${book.Name} by ${book.Author}</li>`;
                            });
                        } else {
                            resultsHtml = '<li class="list-group-item">No results found</li>';
                        }
                        $("#autocompleteResults").html(resultsHtml).show();
                    }
                });
            } else {
                $("#autocompleteResults").hide();
            }
        });

        // Click event for AutoComplete suggestions
        $(document).on("click", ".autocomplete-item", function () {
            $("#searchInput").val($(this).text());
            $("#autocompleteResults").hide();
        });

        // AJAX Search Submission with validation
        $("#searchForm").on("submit", function (e) {
            e.preventDefault();
            let query = $("#searchInput").val();

            // Validation: Check if the query is empty
            if (query.trim() === '') {
                $("#searchError").text("Search query is required.").show();
                return;  // Stop further execution
            } else {
                $("#searchError").hide();  // Hide the error message if query is not empty
            }

            // Perform AJAX search
            $.ajax({
                url: '@Url.Action("SearchBooks", "Books")',
                type: "GET",
                data: { query: query },
                success: function (data) {
                    let resultsHtml = "<h4>Search Results:</h4><ul class='list-group'>";
                    if (data.length > 0) {
                        data.forEach(book => {
                            resultsHtml += `<li class="list-group-item">${book.Name} by ${book.Author}</li>`;
                        });
                    } else {
                        resultsHtml += "<li class='list-group-item'>No books found</li>";
                    }
                    resultsHtml += "</ul>";
                    $("#searchResults").html(resultsHtml);
                }
            });

            // AutoSave search query if it's not empty
            $.ajax({
                url: '@Url.Action("SaveSearch", "Books")',
                type: "POST",
                data: { query: query },
                success: function (response) {
                    console.log("Search saved successfully");
                },
                error: function () {
                    alert('An error occurred while saving the search query.');
                }
            });
        });

        // Hide autocomplete when clicking outside
        $(document).click(function (e) {
            if (!$(e.target).closest("#searchInput, #autocompleteResults").length) {
                $("#autocompleteResults").hide();
            }
        });
    });
</script>




